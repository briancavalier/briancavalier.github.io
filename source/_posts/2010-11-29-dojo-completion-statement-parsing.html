---
layout: post
title: Dojo completion statement parsing
published: true
---

<p style="margin-top: 0px;">One of the things on my&nbsp;<a href="http://blog.briancavalier.com/textmate-dojo-completions-dojorequire-and-doj" title="TextMate Dojo completions: dojo.require and dojo.query - technorthodox" style="color: #0d2681; margin-top: 0px;">Dojo completion hitlist</a>&nbsp;was handling multiline statements, especially&nbsp;<code style="font-size: 12px; font-family: LuxiMono, Bitstream Vera Sans Mono, Monaco, Courier New, monospace; color: #1c360c;">dojo.query</code>&nbsp;chains, since I tend to break them into multiple lines when chaining more than 1 or 2&nbsp;<code style="font-size: 12px; font-family: LuxiMono, Bitstream Vera Sans Mono, Monaco, Courier New, monospace; color: #1c360c;">NodeList</code>&nbsp;function calls (and I&rsquo;m betting most folks do that, too). While thinking about how to handle this, I came to the conclusion that there were basically three ways I could approach it:</p>
<ol>
<li style="margin-top: 0px;">Implement a real Javascript parser that is liberal enough to handle incomplete statements (e.g. it has to handle the statement you&rsquo;re trying to complete!), or</li>
<li>Integrate an existing parser that is liberal enough to handle incomplete statements (I have no idea if a&nbsp;<em style="margin-top: 0px;">liberal</em>&nbsp;open source JS parser exists), or</li>
<li>Implement something simpler and easier that covers most or all of what I think of as&nbsp;<em style="margin-top: 0px;">common cases</em>.</li>
</ol>
<p>I decided to go with #3. In fact, this is my general rule of thumb for the completion bundle in the short and medium term. I want to make something that is both useful, and something I can actually release since I&rsquo;m only working on it a few hours each week. An unreleased, vaporware completion bundle is far less cool than a released one that works 80% of the time.</p>
<p>Here are a few shots of the multiline statement parser in action, completing a&nbsp;<code style="font-size: 12px; font-family: LuxiMono, Bitstream Vera Sans Mono, Monaco, Courier New, monospace; color: #1c360c; margin-top: 0px;">dojo.query</code>chain. Notice also, in the last shot, it guesses correctly that I am starting a new statement, even though I didn&rsquo;t end the previous one with a semicolon. However, it&rsquo;s not perfect, and will almost certainly break under less common conditions. I&rsquo;ve tried, though, to abstract the parser from the completion code in a way that allows the parser to be improved when I find cases where it breaks.</p>
<ol>
<li><img src="/imgs/2010-11-29-dojo-completion-statement-parsing/post3-1.png"></li>
<li><img src="/imgs/2010-11-29-dojo-completion-statement-parsing/post3-2.png"></li>
<li><img src="/imgs/2010-11-29-dojo-completion-statement-parsing/post3-3.png"></li>
<li><img src="/imgs/2010-11-29-dojo-completion-statement-parsing/post3-4.png"></li>
<li><img src="/imgs/2010-11-29-dojo-completion-statement-parsing/post3-5.png"></li></ol>

<p>&nbsp;</p>
